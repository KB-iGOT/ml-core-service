# Release Note 6.0.0 ML Core Service

This version contains various critical tasks that must be completed in order to improve our system's functioning. Please consider the following list of tasks to be completed.

## Migrations

In this release, we have introduced a new feature that includes program start and end dates. To maintain consistency, it is necessary to execute a migration script that updates the existing programs with the start and end date information. Here are the steps to execute the migration script.

### Step 1:

    Navigate to migrations/programs-startDate-EndDate-6.0/

### Step 2:

Run the script which will add startDate and endDate to programs.

    node setProgramsStartDateAndEndDate.js

## Devops Changes:

### Added a New Kafka Topic

The DevOps repository has already been updated with the new Kafka topic that we recently introduced. This subject will make it easier for system components to communicate and exchange data.

    Login To the Jenkins
    Go to Dashboard -> Deploy -> dev {Environment} ->Kubernatives, then click on KafkaSetup
    Click on Build with parameters -> build
    After the KafkaSetup job is finished, From Kubernatives, click on KafkaSetup
    Then Click on Build with parameters -> build

 
After deployment, verify the presence of Kafka topics. Please ensure that the newly added Kafka topic for this release is named `{Environment}.programuser.info`.

### New Environment Keys Added

We added new environment keys to the DevOps repository to accommodate the new features and functionality. For configuration and access to outside services or resources, these keys will be utilised.

Please note you don't need to deploy the DevOps repo. Once the PR is merged, deploy your service, env variable will automatically add from the DevOps branch.

In this release, we have introduced four new environment variables. 

    KAFKA_COMMUNICATIONS_ON_OFF={{ml_core_kafka_communications_on_off | default("ON")}}
    KAFKA_URL={{ml_core_kafka_url | default(groups['processing-cluster-kafka'][0]+':9092')}}
    KAFKA_GROUP_ID={{ml_core_kafka_group_id | default("ml-core-service")}}
    PROGRAM_USERS_JOINED_TOPIC={{ml_core_program_users_joined_topic | default (env_name+".programuser.info")}}

**This keys are already added to private devops Repo**

### Created New APIs and Running the Kong File

We have created new APIs as part of this version to provide the system more capability. The Kong file must be run in order to guarantee seamless integration and effective routing of these APIs. This will make it possible to manage and map API endpoints properly.

#### For Public APIs

There is no automatic deployment in the DevOps repo. We need to deploy it manually. To deploy the kong file changes please follow the below steps

    Login To the Jenkins
    Go to Dashboard -> Deploy -> dev {Environment} ->Kubernatives, then click on OnboardAPIs
    Click on Build with parameters -> build
    After the OnboardAPIs job is finished, From Kubernatives, click on OnboardConsumers
    Then Click on Build with parameters -> build

In this release, a new public API called `joinProgramByUser` has been added for program joining.

### Deploy ml-core-services

there is no automatic deployment in ml-core-services repo. We need to deploy it manually. To deploy the kong file changes please follow below steps

**Steps for dev**

    Log in to Jenkins.
    Navigate to Dashboard -> Build -> managed-learn -> ml-core-service.
    Click on "Build with parameter" and specify the release tag as "release-6.0.0". Proceed to trigger the build. (Note: This step is specific to the development environment and may vary for other environments.)
    Once the job is finished, go to Dashboard -> deploy -> dev {Environment} -> managed-learn -> ml-core-service.
    After approximately 10 minutes, the job should automatically execute. If it doesn't, manually click on "Build with parameter" and initiate the deployment.

**Steps for staging**

    To retrieve the latest release tag for version 6.0.0, please visit the following URL: https://github.com/project-sunbird/ml-core-service/tags.

To proceed with the deployment process, follow the steps below:

    Log in to Jenkins.
    Navigate to Dashboard -> AutoBuild -> StagingManual -> managed-learn -> ml-core-service.
    Click on "Build with parameters" and provide the latest release tag in the field labeled "github_release_tag". Initiate the build process.
    The build job will take approximately 5 minutes to complete.
    After the job finishes, go to Dashboard -> Deploy -> staging -> managed-learn -> ml-core-service.
    Click on "Build with parameters" to initiate the deployment process.
    Once the job is completed, the services will be deployed on the staging environment


